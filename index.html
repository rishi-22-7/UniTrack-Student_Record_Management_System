<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniTrack - SRMS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%232563eb%22 stroke-width=%222%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22><path d=%22M3 21h18%22/><path d=%22M5 21V7l8-4 8 4v14%22/><path d=%22M10 9a3 3 0 0 1 3-3 3 3 0 0 1 3 3v2a3 3 0 0 1-3 3 3 3 0 0 1-3-3V9z%22/></svg>">
</head>
<body class="theme-admin">

    <div id="auth-container" class="active-screen">
        <div class="auth-card">
            <div class="brand-logo">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18M5 21V7l8-4 8 4v14M10 9a3 3 0 0 1 3-3 3 3 0 0 1 3 3v2a3 3 0 0 1-3 3 3 3 0 0 1-3-3V9z"/></svg>
                <h1>UniTrack  </h1>
            </div>
            <p class="auth-sub">Student Management System</p>
            
            <div class="role-tabs">
                <button class="role-btn active" onclick="switchRole('admin')">Admin</button>
                <button class="role-btn" onclick="switchRole('faculty')">Faculty</button>
                <button class="role-btn" onclick="switchRole('student')">Student</button>
            </div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="input-group">
                    <label>ID / Username</label>
                    <input type="text" id="loginUser" required autocomplete="off">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="loginPass" required>
                </div>
                <button type="submit" class="btn-primary full-width">Login to Portal</button>
            </form>
            <p id="loginError" class="error-msg"></p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-small">UT</div>
                <span id="userRoleDisplay">Admin</span>
            </div>
            
            <nav class="nav-links" id="sidebarNav"></nav>
            <nav class="nav-links bottom-nav" id="sidebarBottomNav"></nav>

            <div class="sidebar-footer">
                <button onclick="logout()" class="nav-item logout">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    Logout
                </button>
            </div>
        </aside>

        <main class="workspace">
            <header class="top-bar">
                <div class="header-left">
                    <h2 id="pageTitle">Dashboard</h2>
                </div>
                <div class="user-profile">
                    <div class="text-right">
                        <span id="userNameDisplay" class="u-name">User</span>
                        <span id="userDeptDisplay" class="u-role">General</span>
                    </div>
                    <div class="avatar" id="userAvatar">U</div>
                </div>
            </header>

            <div id="contentArea" class="content-wrapper"></div>
        </main>
    </div>

    <div id="modalFaculty" class="modal-overlay hidden">
        <div class="modal-card">
            <h3>Faculty Details</h3>
            <div class="form-grid">
                <div class="input-group"><label>Username</label><input id="modFacUser"></div>
                <div class="input-group"><label>Department</label>
                    <select id="modFacDept"><option>CSE</option><option>ECE</option><option>MECH</option><option>CIVIL</option><option>EEE</option></select>
                </div>
                <div class="input-group"><label>Password</label><input id="modFacPass"></div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('modalFaculty')">Cancel</button>
                <button class="btn-primary" onclick="saveFacultyFromModal()">Save Faculty</button>
            </div>
        </div>
    </div>

    <div id="modalMarks" class="modal-overlay hidden">
        <div class="modal-card">
            <h3>Update CGPA</h3>
            <p id="markStudentName" class="text-muted" style="margin-bottom:15px"></p>
            <input type="hidden" id="markRoll">
            <div class="input-group">
                <label>New CGPA (0 - 10)</label>
                <input type="number" id="newMark" step="0.01" min="0" max="10">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('modalMarks')">Cancel</button>
                <button class="btn-primary" onclick="submitMarkUpdate()">Update</button>
            </div>
        </div>
    </div>

    <div id="modalStudent" class="modal-overlay hidden">
        <div class="modal-card">
            <h3>Edit Student</h3>
            <input type="hidden" id="editStuRoll">
            <div class="form-grid">
                <div class="input-group"><label>Full Name</label><input id="editStuName"></div>
                <div class="input-group"><label>Password</label><input id="editStuPass"></div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('modalStudent')">Cancel</button>
                <button class="btn-primary" onclick="submitStudentEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="modalFeeSettings" class="modal-overlay hidden">
        <div class="modal-card">
            <h3>Edit Base Fees</h3>
            <div class="form-grid">
                <div class="input-group"><label>CSE Fee</label><input type="number" id="feeCSE"></div>
                <div class="input-group"><label>ECE Fee</label><input type="number" id="feeECE"></div>
                <div class="input-group"><label>MECH Fee</label><input type="number" id="feeMECH"></div>
                <div class="input-group"><label>CIVIL Fee</label><input type="number" id="feeCIVIL"></div>
                <div class="input-group"><label>EEE Fee</label><input type="number" id="feeEEE"></div>
                <div class="input-group"><label>Hostel Fee</label><input type="number" id="feeHostel"></div>
                <div class="input-group"><label>Bus Fee</label><input type="number" id="feeBus"></div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('modalFeeSettings')">Cancel</button>
                <button class="btn-primary" onclick="saveFeeSettings()">Update Fees</button>
            </div>
        </div>
    </div>

    <div id="modalChangePass" class="modal-overlay hidden">
        <div class="modal-card">
            <h3>Change Password</h3>
            <div class="input-group">
                <label>Current Password</label>
                <input type="password" id="currPass">
            </div>
            <div class="input-group">
                <label>New Password</label>
                <input type="password" id="newPass">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('modalChangePass')">Cancel</button>
                <button class="btn-primary" onclick="submitChangePass()">Change</button>
            </div>
        </div>
    </div>

    <div id="modalFinanceAction" class="modal-overlay hidden">
        <div class="modal-card">
            <h3>Manage Finances</h3>
            <p id="finActionName" class="text-muted" style="margin-bottom:15px"></p>
            <input type="hidden" id="finActionRoll">
            <div class="input-group">
                <label>Amount</label>
                <input type="number" id="finActionAmount" placeholder="Enter amount">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('modalFinanceAction')">Cancel</button>
                <button class="btn-danger" onclick="submitFinanceAction('fine')">Add Fine</button>
                <button class="btn-primary" onclick="submitFinanceAction('pay')">Receive Payment</button>
            </div>
        </div>
    </div>

    <div id="modalStudentPay" class="modal-overlay hidden">
        <div class="modal-card">
            <h3>Pay Fees</h3>
            <p class="text-muted" style="margin-bottom:10px">Total Due: <span id="stuPayTotal"></span></p>
            <div class="input-group">
                <label>Enter Amount to Pay (Partial/Full)</label>
                <input type="number" id="stuPayAmount" placeholder="Amount">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal('modalStudentPay')">Cancel</button>
                <button class="btn-primary" onclick="submitStudentPay()">Make Payment</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast hidden">Action Successful</div>

    <script src="script.js"></script>
</body>
</html>